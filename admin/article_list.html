<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>文章列表</title>
  <link rel="stylesheet" href="./libs/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./css/iconfont.css">
  <link rel="stylesheet" href="./css/main.css">
  <!-- 引入jQuery的js文件 -->
  <script src="./libs/jquery-1.12.4.min.js"></script>
  <!-- 引入模板引擎js文件 -->
  <script src="./libs/template-web.js"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="common_title">
      文章列表
    </div>
    <div class="container-fluid common_con">
      <div class="row opt_btns">
        <div class="col-xs-6">
          <form class="form-inline">
            <select id="selCategory" name="" class="form-control input-sm fenlei">
                <!-- 所有分类的位置 -->
                        </select>
            <select id="selStatus" name="" class="form-control input-sm state">
                            <option value="">所有状态</option>
                            <option value="草稿">草稿</option>
                            <option value="已发布">已发布</option>
                        </select>
            <button id="btnSearch" class="btn btn-default btn-sm screen">筛选</button>
          </form>
        </div>
        <div class="col-xs-6">
          <a href="article_release.html" class="btn btn-success btn-sm pull-right" id="release_btn">发表文章</a>
        </div>
      </div>
      <table class="table table-striped table-bordered table-hover mp20">
        <thead>
          <tr>
            <th>标题</th>
            <th>作者</th>
            <th>分类</th>
            <th class="text-center">发表时间</th>
            <th class="text-center">状态</th>
            <th class="text-center" width="100">操作</th>
          </tr>
        </thead>
        <tbody>
          <!-- tr内容放置的位置 -->
        </tbody>
      </table>
      <div class="row text-center">
      </div>
    </div>
  </div>
</body>
<!-- 给所有分类  定义引擎模板  -->
<!-- 渲染数据的时候还需要将获取到的id值渲染到option中的value属性中 -->
<script type="text/html" id="all_fenlei">
  <option value="">所有分类</option>
  {{each data}}
  <option value="{{$value.id}}">{{$value.name}}</option>
  {{ /each }}
</script>

<!-- 给获取到文章内容定义模板 -->
<script type="text/html" id="all_wenzhang">
  {{each data.data}}
  <tr>
    <td>{{$value.title}}</td>
    <td>{{$value.author}}</td>
    <td>{{$value.category}}</td>
    <td class="text-center">{{$value.date}}</td>
    <td class="text-center">{{$value.state}}</td>
    <td class="text-center">
      <a href="article_edit.html" class="btn btn-default btn-xs">编辑</a>
      <a href="javascript:void(0);" class="btn btn-danger btn-xs delete">删除</a>
    </td>
  </tr>
  {{/each}}
</script>

<script>
  // 
  $(function() {
      // 需求：使用ajax请求服务器获取所有分类，并将获取到的分类渲染到页面所有分类的下拉列表中
      $.ajax({
        url: BigNew.category_list,
        success: function(result) {
          console.log(result);
          var str = template('all_fenlei', result);
          //   打印一下，看看能不能将响应的内容获取到
          //   console.log(str);
          $('.fenlei').html(str);
        }
      });


      //   需求：加载页面的时候需要获取所有文章数据
      $.ajax({
        //   设置url接口地址
        url: BigNew.article_query,
        // 设置请求方式
        type: 'get',
        // 响应服务器的数据
        success: function(result) {
          console.log(result);
          //   调用template()方法，第一个参数是定义模板的id名，第二个参数是获取的数据
          var str = template('all_wenzhang', result);
          //   console.log(str);
          //   将获取到的内容添加到tbody中
          $('tbody').html(str);
        }
      });

      //   需求：当我们点击筛选按钮的时候需要根据分类和状态来显示所对应的文章
      $('.screen').click(function(e) {
        // 将按钮的默认行为禁止掉
        e.preventDefault();
        // 获取所有分类select的标签中的value值，这里要注意，获取select中的value值的时候也是使用val()这个方法
        var type = $('#selCategory').val();
        var state = $('.state').val();
        // 打印一下，看看是否能获取到两个下拉列表中的内容
        // console.log(type, state);
        $.ajax({
          // 设置请求接口
          url: BigNew.article_query,
          // 设置请求方式
          type: 'get',
          // 设置请求参数
          data: {
            type: type,
            state: state,
          },
          success: function(result) {
            // console.log(result);
            // 我们将获取到的数据渲染到页面上，还是使用模板引擎来将获取到的内容渲染到页面上
            var str = template('all_wenzhang', result);
            //   将获取到的内容添加到tbody中
            $('tbody').html(str);
          }
        });
      });




    })
    //
</script>

</html>